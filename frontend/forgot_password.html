<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Codavatar InternTrack - Forgot Password</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="brand">
        <div>
          <h1>Forgot Password</h1>
          <small>We will email a reset link</small>
        </div>
        <button class="toggle" onclick="toggleTheme()">ğŸŒ™/â˜€ï¸ Theme</button>
      </div>

      <div id="msg" class="msg"></div>

      <form id="form" class="form">
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@codavatar.com" required />
        </div>

        <button id="sendBtn" class="btn" type="button">Send reset link</button>

        <div class="footer">
          <a class="small-link" href="login.html">Back to login</a>
        </div>
      </form>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/auth.js"></script>
  <script>
    initTheme();
    const msg = document.getElementById("msg");
    const form = document.getElementById("form");
    const sendBtn = document.getElementById("sendBtn");

    bindEnterToSubmit(form, sendBtn);

    async function sendReset() {
      hideMsg(msg);
      sendBtn.disabled = true;

      const email = document.getElementById("email").value.trim().toLowerCase();

      try {
        const res = await apiFetch("/accounts/forgot-password/", {
          method: "POST",
          body: JSON.stringify({ email })
        });

        const data = await res.json().catch(() => ({}));

        // backend intentionally returns success even if email doesn't exist
        if (!res.ok) {
          showMsg(msg, data.detail || "Request failed", "err");
          sendBtn.disabled = false;
          return;
        }

        showMsg(msg, data.detail || "If this email exists, a reset link has been sent.", "ok");
        form.reset();
      } catch (e) {
        showMsg(msg, "Network error. Is backend running?", "err");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", sendReset);
  </script>
</body>
</html>
